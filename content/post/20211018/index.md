---
draft: false
title: "ゼロからのOS自作入門を読んで\n OS を実装してみた"
date: 2021-10-17T19:29:55Z
tags: ["OS", "Kernel"]
pinned: false
ogimage: "img/images/20211018.png"
---

## 概要

- こんにちは！今年の 8 月中旬から[ゼロからのOS自作入門](https://www.amazon.co.jp/%E3%82%BC%E3%83%AD%E3%81%8B%E3%82%89%E3%81%AEOS%E8%87%AA%E4%BD%9C%E5%85%A5%E9%96%80-%E5%86%85%E7%94%B0-%E5%85%AC%E5%A4%AA/dp/4839975868)を読んで紹介されている OS を一通り写経して作り上げてみました。そこで、今回はこの本を読むまでに何をしていたかを振り返りつつ、読もうと思ったきっかけや感想などを残したいと思います。

## きっかけ

- 今年度で学生生活が最後で時間に余裕がある内に、コンピュータや OS について詳しくなりたいと思っていました。自分は普段から Ubuntu 18.04 を使っているのですが、低レイヤや Linux に詳しくありません。そのため、まず初めの取っ掛かりとして低レイヤ周りの本や資料を少しずつ読んだりしていました。例えば以下が挙げられます。

  - [[試して理解]Linuxのしくみ ~実験と図解で学ぶOSとハードウェアの基礎知識](https://www.amazon.co.jp/%E8%A9%A6%E3%81%97%E3%81%A6%E7%90%86%E8%A7%A3-Linux%E3%81%AE%E3%81%97%E3%81%8F%E3%81%BF-%E5%AE%9F%E9%A8%93%E3%81%A8%E5%9B%B3%E8%A7%A3%E3%81%A7%E5%AD%A6%E3%81%B6OS%E3%81%A8%E3%83%8F%E3%83%BC%E3%83%89%E3%82%A6%E3%82%A7%E3%82%A2%E3%81%AE%E5%9F%BA%E7%A4%8E%E7%9F%A5%E8%AD%98-%E6%AD%A6%E5%86%85-%E8%A6%9A/dp/477419607X)
  - [コンピュータシステムの理論と実装 ―モダンなコンピュータの作り方](https://www.amazon.co.jp/%E3%82%B3%E3%83%B3%E3%83%94%E3%83%A5%E3%83%BC%E3%82%BF%E3%82%B7%E3%82%B9%E3%83%86%E3%83%A0%E3%81%AE%E7%90%86%E8%AB%96%E3%81%A8%E5%AE%9F%E8%A3%85-%E2%80%95%E3%83%A2%E3%83%80%E3%83%B3%E3%81%AA%E3%82%B3%E3%83%B3%E3%83%94%E3%83%A5%E3%83%BC%E3%82%BF%E3%81%AE%E4%BD%9C%E3%82%8A%E6%96%B9-Noam-Nisan/dp/4873117127)
  - [低レイヤを知りたい人のためのCコンパイラ作成入門](https://www.sigbus.info/compilerbook)
  - [ふつうのLinuxプログラミング 第2版 Linuxの仕組みから学べるgccプログラミングの王道](https://www.amazon.co.jp/%E3%81%B5%E3%81%A4%E3%81%86%E3%81%AELinux%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%9F%E3%83%B3%E3%82%B0-%E7%AC%AC2%E7%89%88-Linux%E3%81%AE%E4%BB%95%E7%B5%84%E3%81%BF%E3%81%8B%E3%82%89%E5%AD%A6%E3%81%B9%E3%82%8Bgcc%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%9F%E3%83%B3%E3%82%B0%E3%81%AE%E7%8E%8B%E9%81%93-%E9%9D%92%E6%9C%A8-%E5%B3%B0%E9%83%8E/dp/4797386479)
  - [基礎からわかるTCP/IP ネットワーク実験プログラミング（第2版）](https://www.ohmsha.co.jp/book/9784274065842/)
  - [Hacking: 美しき策謀 第2版 ―脆弱性攻撃の理論と実際](https://www.amazon.co.jp/Hacking-%E7%BE%8E%E3%81%97%E3%81%8D%E7%AD%96%E8%AC%80-%E2%80%95%E8%84%86%E5%BC%B1%E6%80%A7%E6%94%BB%E6%92%83%E3%81%AE%E7%90%86%E8%AB%96%E3%81%A8%E5%AE%9F%E9%9A%9B-Jon-Erickson/dp/4873115140)
  - [ハロー“Hello, World” OSと標準ライブラリのシゴトとしくみ](https://www.amazon.co.jp/%E3%83%8F%E3%83%AD%E3%83%BC%E2%80%9CHello-World%E2%80%9D-OS%E3%81%A8%E6%A8%99%E6%BA%96%E3%83%A9%E3%82%A4%E3%83%96%E3%83%A9%E3%83%AA%E3%81%AE%E3%82%B7%E3%82%B4%E3%83%88%E3%81%A8%E3%81%97%E3%81%8F%E3%81%BF-%E5%9D%82%E4%BA%95%E5%BC%98%E4%BA%AE-ebook/dp/B01GH9AM8C)

- このように Linux や低レイヤに興味がありつつ、大学の先輩が Linux Kernel にコントリビュートし楽しそうにしている様子を見たり、研究室の隣の同期がこの本を読み切ったりしていて、今始めることがチャンスだと思い、思い切って初めてみました。

## 感想

- OS を一から作り上げる行為は、低レイヤの総合格闘技感があり、非常に楽しかったです。この本を通して個人的に特に面白かった箇所を抜粋して挙げていきます。
  - 一番初めの `Hello World` を出力できた時
  - C++ で実装できないロジックをアセンブリ言語で実装した時
  - 割り込みを実装し、メッセージを送受信できた時
  - コンテキストスイッチの実装を知った時
  - Priority Queue を使ってタスクに優先度を付け、タスクを Sleep/Running できるように実装した時
  - 初めてシステムコールを実装した時
  - ファイルの書き込みファイルディスクリプタで抽象化した時
  - ページフォルトを活用してデマンドページングを実装した時
  - 実装のバグを調査するために `printk` や `Log` でデバッグをたくさんした時
  - この本を読んだ研究室の同期と OS の機能に関する実装に関する議論ができたこと

- また、細かい日記に関しては以下に記述しました。全く書いていない箇所もあればデバッグが辛かった様子を書いたりしていて、内容に関してはまちまちです。

  - [自作 OS 日記 (1)](https://haytok.jp/post/20210830/)
  - [自作 OS 日記 (2)](https://haytok.jp/post/20210831/)
  - [自作 OS 日記 (3)](https://haytok.jp/post/20210901/)

## 最後に

- 大学の講義や本を通して OS の理論を漠然と理論は知っていたものの、プログラムレベルまでの実装がイメージできなかったことがかなりクリアになりました。かなり多くのことを学べてかなり楽しかったです。この本を通して得た OS 周りの知識をさらに深めたいとは思っているのですが、これから具体的にどんなアクションを取るかは決めていません。ですが、ひとまずこの素晴らしい記事 ([Linux カーネルを QEMU 上で起動する ](https://kuniyu.jp/ja/blog/2/)) を参考に Linux Kernel をビルドし、起動はしてみたので、それを使って何か遊んでみつつ、機能を絞って Linux Kernel のコードを読んでみたいと思います🤞

## 参考

- [ゼロからのOS自作入門](https://www.amazon.co.jp/%E3%82%BC%E3%83%AD%E3%81%8B%E3%82%89%E3%81%AEOS%E8%87%AA%E4%BD%9C%E5%85%A5%E9%96%80-%E5%86%85%E7%94%B0-%E5%85%AC%E5%A4%AA/dp/4839975868)
- [mikanos](https://github.com/uchan-nos/mikanos)
- [honOS](https://github.com/haytok/honOS)
